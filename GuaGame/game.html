<html>
  <head>
    <meta charset="utf-8">
    <title>game 1</title>
    <style media="screen">
      canvas{
        border: 1px black solid;
      }
    </style>
    <script src='guagame.js'></script>
    <script src='ball.js'></script>
    <script src='paddle.js'></script>
    <script src='block.js'></script>
    <script src='utils.js'></script>
    <script src='level.js'></script>
  </head>
  <body>
      <canvas id="id-canvas" width="600" height="500"></canvas>

<script>
var loadLevel = function(n){
  n = n - 1
  var level = levels[n]
  var blocks = []
  for (var i = 0; i < level.length; i++) {
    var p = level[i]
    var b = Block(p)
    blocks.push(b)
  }
  return blocks
}
var blocks = []
var __main = function(){
  var game = GuaGame(60)
  var paddle = Paddle()
  var ball = Ball()
  blocks = loadLevel(1)

  var leftDown = false
  var rigntDown = false
  var paused = false
  game.registerAction('a', function(){
    paddle.moveLeft()
  })
  game.registerAction('d', function(){
    paddle.moveRight()
  })
  game.registerAction('f', function(){
    ball.fire()
  })
  //注册一个按键
  // game.registerAction('p', function(){
  //   paused = !paused
  // })
  window.addEventListener('keydown', function(event){
    if (event.key == 'p') {
      paused = !paused
    }else if (event.key == '1'){
      blocks = loadLevel(1)
    }else if (event.key == '2') {
      blocks = loadLevel(2)
    }
  })
  game.update = function(){
    if(paused){
      return
    }
    ball.move()
    //判断相撞
    if (paddle.collide(ball)) {
      //这里应该调用一个 ball.反弹() 来实现
      ball.反弹()
    }
    //判断ball和block相撞
    for (var i = 0; i < blocks.length; i++) {
      var block = blocks[i]
      if (block.collide(ball)) {
        log('block 相撞')
        block.kill()
        ball.反弹()
      }
    }
  }
  game.draw = function(){
    // game.context.drawImage(paddle.image, paddle.x, paddle.y)
    game.drawImage(paddle)
    game.drawImage(ball)
    for (var i = 0; i < blocks.length; i++) {
      var block = blocks[i]
      //draw block
      if (block.alive) {
        game.drawImage(block)
      }
    }
  }
}
__main()

</script>
  </body>

</html>
